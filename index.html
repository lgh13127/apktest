<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>æ¼”æ’­æ™ºè”</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            display: flex;
            flex-direction: column;
            padding: 10px;
        }
        
        /* é¡µé¢é€šç”¨æ ·å¼ */
        .page {
            display: none;
            flex: 1;
            min-height: 0; /* å…è®¸flexå­é¡¹ç¼©å° */
        }
        
        .page.active {
            display: flex;
            flex-direction: column;
        }
        
        /* ä¸€çº§é¡µé¢ç‰¹æ®Šå¤„ç† */
        #main-page.active {
            display: block;
        }
        
        /* äºŒçº§é¡µé¢å®¹å™¨ */
        .secondary-page-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
            overflow: hidden;
            padding: 12px;
            flex: 1;
            display: flex;
            flex-direction: column;
            width: 100%;
        }
        
        /* ä¸€çº§é¡µé¢å®¹å™¨ */
        .main-page-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            padding: 20px;
            width: 100%;
        }
        
        .header {
            text-align: center;
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .header h1 {
            color: #333;
            font-size: 20px;
            margin-bottom: 5px;
            font-weight: 700;
        }
        
        .header p {
            color: #666;
            font-size: 12px;
        }
        
        .control-panel {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
        }
        
        .input-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 16px;
        }
        
        .input-field {
            width: 100%;
        }
        
        .input-field label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
            font-size: 12px;
        }
        
        .input-field input {
            width: 100%;
            padding: 10px;
            border: 1.5px solid #e0e0e0;
            border-radius: 8px;
            font-size: 13px;
            transition: all 0.3s;
            background: white;
        }
        
        .input-field input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.1);
        }
        
        .input-field input::placeholder {
            color: #aaa;
            font-size: 12px;
        }
        
        .token-hint {
            font-size: 10px;
            color: #888;
            margin-top: 4px;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .token-hint i {
            color: #ff9800;
        }
        
        .button-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 16px;
        }
        
        .main-btn {
            padding: 12px 16px;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            width: 100%;
            min-height: 45px;
        }
        
        .main-btn:active {
            transform: scale(0.98);
        }
        
        .main-btn:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }
        
        .main-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }
        
        .call-btn {
            background: linear-gradient(to right, #667eea, #764ba2);
            color: white;
        }
        
        .call-btn:hover {
            background: linear-gradient(to right, #5a6fd8, #6b4190);
        }
        
        .call-btn.in-call {
            background: linear-gradient(to right, #ff6b6b, #ff5252);
        }
        
        .call-btn.in-call:hover {
            background: linear-gradient(to right, #ff5252, #e53935);
        }
        
        .tally-btn {
            background: linear-gradient(to right, #4CAF50, #2E7D32);
            color: white;
        }
        
        .tally-btn:hover {
            background: linear-gradient(to right, #43a047, #1b5e20);
        }
        
        .tally-call-btn {
            background: linear-gradient(to right, #FF9800, #F57C00);
            color: white;
        }
        
        .tally-call-btn:hover {
            background: linear-gradient(to right, #FB8C00, #EF6C00);
        }
        
        .back-btn {
            background: #6c757d;
            color: white;
            padding: 8px 14px;
            border-radius: 8px;
            border: none;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            width: 100%;
            margin-bottom: 8px;
            flex-shrink: 0;
        }
        
        .back-btn:hover {
            background: #5a6268;
        }
        
        /* é€šè¯é¡µé¢æ ·å¼ */
        .call-page .button-group {
            flex-direction: row;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }
        
        .call-page .main-btn {
            flex: 1;
            min-width: 120px;
        }
        
        .mic-btn {
            background: #4CAF50;
            color: white;
        }
        
        .mic-btn:hover {
            background: #43a047;
        }
        
        .mic-btn.muted {
            background: #ff6b6b;
        }
        
        .mic-btn.muted:hover {
            background: #ff5252;
        }
        
        .call-status {
            text-align: center;
            margin: 10px 0;
            padding: 8px;
            border-radius: 6px;
            background: #f8f9fa;
            font-weight: 600;
            font-size: 12px;
            display: none;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-6px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .call-status.connected {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .call-status.disconnected {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .members-container {
            background: white;
            border-radius: 10px;
            padding: 14px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.04);
            margin-top: 12px;
            flex: 1;
            overflow-y: auto;
            min-height: 0; /* å…è®¸flexå­é¡¹ç¼©å° */
        }
        
        .members-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid #f0f0f0;
            position: sticky;
            top: 0;
            background: white;
            z-index: 1;
        }
        
        .members-header h2 {
            color: #333;
            font-size: 14px;
        }
        
        .members-count {
            background: #667eea;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 11px;
        }
        
        .members-list {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
        }
        
        .member-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
            border: 1.5px solid transparent;
        }
        
        .member-card:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.06);
            border-color: #667eea;
        }
        
        .member-card.local {
            background: linear-gradient(135deg, #e3f2fd, #f3e5f5);
        }
        
        .avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
            color: white;
            flex-shrink: 0;
        }
        
        .avatar.local {
            background: linear-gradient(135deg, #667eea, #764ba2);
        }
        
        .avatar.remote {
            background: linear-gradient(135deg, #4CAF50, #2E7D32);
        }
        
        .member-info {
            flex: 1;
            min-width: 0;
        }
        
        .member-name {
            font-weight: 600;
            color: #333;
            font-size: 13px;
            margin-bottom: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .member-uid {
            color: #666;
            font-size: 10px;
            margin-bottom: 3px;
        }
        
        .member-status {
            display: inline-flex;
            align-items: center;
            gap: 3px;
            padding: 2px 5px;
            border-radius: 8px;
            font-size: 9px;
            font-weight: 600;
        }
        
        .status-online {
            background: #e8f5e9;
            color: #2E7D32;
        }
        
        .status-muted {
            background: #ffebee;
            color: #c62828;
        }
        
        .status-speaker {
            background: #e3f2fd;
            color: #1565c0;
        }
        
        .member-actions {
            display: flex;
            gap: 5px;
        }
        
        .action-btn {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            font-size: 12px;
            flex-shrink: 0;
        }
        
        .mute-btn {
            background: #ffebee;
            color: #c62828;
        }
        
        .mute-btn:hover {
            background: #ffcdd2;
        }
        
        .mute-btn.muted {
            background: #e0e0e0;
            color: #616161;
        }
        
        .empty-state {
            text-align: center;
            padding: 20px 10px;
            color: #666;
        }
        
        .empty-state i {
            font-size: 32px;
            margin-bottom: 10px;
            display: block;
            color: #ccc;
        }
        
        .empty-state p {
            font-size: 12px;
        }
        
        .footer {
            text-align: center;
            margin-top: 10px;
            color: #666;
            font-size: 10px;
            padding-top: 8px;
            border-top: 1px solid #eee;
            flex-shrink: 0;
        }
        
        /* TALLYæ˜¾ç¤ºé¡µé¢æ ·å¼ - å…¨å±è‡ªé€‚åº” */
        .tally-page-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0;
        }
        
        .tally-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0;
            background: #f8f9fa;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }
        
        .tally-frame {
            flex: 1;
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 6px;
            background: white;
            min-height: 0;
        }
        
        /* TALLY+é€šè¯é¡µé¢æ ·å¼ */
        .tally-call-page-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0;
            gap: 6px;
        }
        
        .tally-call-controls-container {
            min-height: 0;
            display: flex;
            flex-direction: column;
            background: #f8f9fa;
            border-radius: 8px;
            overflow: hidden;
            padding: 8px;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.03);
            flex-shrink: 0;
        }
        
        .tally-call-controls {
            display: flex;
            flex-direction: column;
            gap: 6px;
            flex: 1;
            justify-content: center;
        }
        
        .tally-call-buttons {
            display: flex;
            flex-direction: row; /* ç¡®ä¿ä¸¤ä¸ªæŒ‰é’®åœ¨ä¸€æ’æ˜¾ç¤º */
            gap: 8px;
            margin-bottom: 6px;
        }
        
        .tally-call-buttons .main-btn {
            flex: 1;
            min-height: 38px;
            padding: 8px 10px;
            font-size: 12px;
            border-radius: 6px;
        }
        
        .tally-call-status {
            text-align: center;
            margin: 4px 0;
            padding: 5px;
            border-radius: 5px;
            background: #f8f9fa;
            font-weight: 600;
            font-size: 10px;
            display: none;
            animation: fadeIn 0.3s ease;
        }
        
        .tally-call-status.connected {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .tally-call-status.disconnected {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .tally-call-display-container {
            flex: 1;
            min-height: 0;
            display: flex;
            flex-direction: column;
            background: #f8f9fa;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }
        
        .tally-call-display {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 0;
            position: relative;
        }
        
        .tally-call-frame {
            flex: 1;
            width: 100%;
            height: 100%;
            border: none;
            background: white;
            min-height: 0;
            display: block; /* ç¡®ä¿iframeæ˜¾ç¤º */
        }
        
        /* ç§»åŠ¨ç«¯ä¼˜åŒ– - é’ˆå¯¹æ‰‹æœºç«¯ç‰¹åˆ«ä¼˜åŒ– */
        @media (max-width: 768px) {
            body {
                padding: 6px;
            }
            
            .secondary-page-container {
                padding: 10px;
                border-radius: 10px;
            }
            
            .main-page-container {
                padding: 16px;
                border-radius: 12px;
            }
            
            .header h1 {
                font-size: 18px;
            }
            
            .header p {
                font-size: 11px;
            }
            
            .control-panel {
                padding: 12px;
            }
            
            .main-btn {
                padding: 10px 14px;
                font-size: 12px;
                min-height: 42px;
            }
            
            /* é¡µé¢3çš„ç‰¹åˆ«ä¼˜åŒ– */
            #tally-call-page .header h1 {
                font-size: 16px;
                margin-bottom: 0;
            }
            
            #tally-call-page .tally-call-controls-container {
                padding: 6px;
                margin-bottom: 4px;
            }
            
            #tally-call-page .tally-call-buttons {
                gap: 6px;
            }
            
            #tally-call-page .tally-call-buttons .main-btn {
                min-height: 36px;
                padding: 6px 8px;
                font-size: 11px;
            }
            
            #tally-call-page .tally-call-status {
                font-size: 9px;
                padding: 4px;
                margin: 3px 0;
            }
            
            #tally-call-page .tally-call-display-container {
                border-radius: 8px;
            }
            
            /* å…¶ä»–é¡µé¢çš„ä¼˜åŒ– */
            .call-page .button-group {
                flex-direction: column;
            }
            
            .call-page .main-btn {
                min-width: 100%;
            }
            
            .members-list {
                grid-template-columns: 1fr;
            }
            
            .back-btn {
                padding: 6px 12px;
                font-size: 12px;
                margin-bottom: 6px;
            }
        }
        
        @media (min-width: 769px) {
            .input-group {
                flex-direction: row;
            }
            
            .input-field {
                flex: 1;
            }
            
            .button-group {
                flex-direction: row;
            }
            
            .main-btn {
                width: auto;
                flex: 1;
            }
            
            .members-list {
                grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
            }
        }
        
        /* æ‰‹æœºæ¨ªå±ä¼˜åŒ– */
        @media (max-width: 768px) and (orientation: landscape) {
            #tally-call-page .tally-call-controls-container {
                flex-direction: row;
                align-items: center;
            }
            
            #tally-call-page .tally-call-controls {
                flex-direction: row;
                align-items: center;
                gap: 8px;
            }
            
            #tally-call-page .tally-call-buttons {
                flex-direction: row;
                margin-bottom: 0;
                flex: 1;
            }
            
            #tally-call-page .tally-call-status {
                flex: 1;
                margin: 0;
            }
        }
        
        /* é˜²æ­¢é•¿æŒ‰é€‰ä¸­æ–‡æœ¬ */
        * {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        input, textarea {
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- ä¸€çº§é¡µé¢ -->
    <div id="main-page" class="page active">
        <div class="main-page-container">
            <div class="header">
                <h1>ğŸ¤ æ¼”æ’­æ™ºè”-é€šè¯ç³»ç»Ÿ</h1>
                <p>é€‰æ‹©åŠŸèƒ½æ¨¡å—</p>
            </div>
            
            <div class="control-panel">
                <div class="input-group">
                    <div class="input-field">
                        <label for="channelName"><i class="fas fa-hashtag"></i> é¢‘é“åç§°</label>
                        <input type="text" id="channelName" placeholder="å¦‚ï¼šmeeting-room-1" autocomplete="off">
                    </div>
                    
                    <div class="input-field">
                        <label for="tokenInput"><i class="fas fa-key"></i> é‰´æƒä»¤ç‰Œ</label>
                        <input type="text" id="tokenInput" placeholder="è¾“å…¥ä¸´æ—¶Token" autocomplete="off">
                        <div class="token-hint">
                            <i class="fas fa-info-circle"></i>
                            <span>ç®¡ç†å‘˜ä¸‹å‘çš„ä¸´æ—¶Token</span>
                        </div>
                    </div>
                </div>
                
                <div class="input-group">
                    <div class="input-field">
                        <label for="urlInput"><i class="fas fa-link"></i> TALLYç½‘å€</label>
                        <input type="text" id="urlInput" placeholder="https://example.com/tally" autocomplete="off">
                        <div class="token-hint">
                            <i class="fas fa-info-circle"></i>
                            <span>è¾“å…¥TALLYæ˜¾ç¤ºç½‘é¡µåœ°å€</span>
                        </div>
                    </div>
                </div>
                
                <div class="button-group">
                    <button class="main-btn call-btn" id="joinCallBtn">
                        <i class="fas fa-phone-alt"></i>
                        <span>åŠ å…¥é€šè¯</span>
                    </button>
                    
                    <button class="main-btn tally-btn" id="showTallyBtn">
                        <i class="fas fa-desktop"></i>
                        <span>TALLYæ˜¾ç¤º</span>
                    </button>
                    
                    <button class="main-btn tally-call-btn" id="tallyCallBtn">
                        <i class="fas fa-broadcast-tower"></i>
                        <span>TALLY+é€šè¯</span>
                    </button>
                </div>
            </div>
            
            <div class="footer">
                <p>ä¸ªäººè‡ªç ” æ¬¢è¿è¯•ç”¨</p>
            </div>
        </div>
    </div>
    
    <!-- äºŒçº§é¡µé¢1ï¼šé€šè¯é¡µé¢ -->
    <div id="call-page" class="page">
        <div class="secondary-page-container">
            <button class="back-btn" onclick="goBack()">
                <i class="fas fa-arrow-left"></i>
                è¿”å›ä¸»é¡µé¢
            </button>
            
            <div class="header">
                <h1>ğŸ¤ é€šè¯é¢‘é“</h1>
                <p>é¢‘é“ï¼š<span id="currentChannel"></span></p>
            </div>
            
            <div class="control-panel">
                <div class="button-group">
                    <button class="main-btn call-btn" id="callToggle">
                        <i class="fas fa-phone-alt"></i>
                        <span id="callText">åŠ å…¥é€šè¯</span>
                    </button>
                    <button class="main-btn mic-btn" id="micToggle" disabled>
                        <i class="fas fa-microphone"></i>
                        <span id="micText">å¼€å¯è¯ç­’</span>
                    </button>
                </div>
                
                <div id="callStatus" class="call-status">
                    <i class="fas fa-circle-notch fa-spin"></i>
                    <span id="statusText">æ­£åœ¨è¿æ¥...</span>
                </div>
            </div>
            
            <div class="members-container">
                <div class="members-header">
                    <h2><i class="fas fa-users"></i> é€šè¯æˆå‘˜</h2>
                    <div class="members-count">
                        <span id="memberCount">0</span> äººåœ¨çº¿
                    </div>
                </div>
                
                <div id="membersList" class="members-list">
                    <div class="empty-state">
                        <i class="fas fa-user-friends"></i>
                        <p>é¢‘é“å†…æš‚æ— æˆå‘˜</p>
                        <p style="font-size: 11px; margin-top: 5px;">åŠ å…¥é¢‘é“åï¼Œæˆå‘˜åˆ—è¡¨å°†åœ¨è¿™é‡Œæ˜¾ç¤º</p>
                    </div>
                </div>
            </div>
            
            <div class="footer">
                <p>ä¸ªäººè‡ªç ” æ¬¢è¿è¯•ç”¨</p>
            </div>
        </div>
    </div>
    
    <!-- äºŒçº§é¡µé¢2ï¼šTALLYæ˜¾ç¤ºé¡µé¢ -->
    <div id="tally-page" class="page">
        <div class="secondary-page-container">
            <button class="back-btn" onclick="goBack()">
                <i class="fas fa-arrow-left"></i>
                è¿”å›ä¸»é¡µé¢
            </button>
            
            <div class="header">
                <h1>ğŸ“º TALLYæ˜¾ç¤º</h1>
                <p>æ˜¾ç¤ºå¤–éƒ¨TALLYç½‘é¡µ</p>
            </div>
            
            <div class="tally-page-content">
                <div class="tally-container">
                    <!-- iframeå°†åœ¨è¿™é‡ŒåŠ¨æ€åˆ›å»º -->
                </div>
            </div>
            
            <div class="footer">
                <p>ä¸ªäººè‡ªç ” æ¬¢è¿è¯•ç”¨</p>
            </div>
        </div>
    </div>
    
    <!-- äºŒçº§é¡µé¢3ï¼šTALLY+é€šè¯é¡µé¢ -->
    <div id="tally-call-page" class="page">
        <div class="secondary-page-container">
            <button class="back-btn" onclick="goBack()">
                <i class="fas fa-arrow-left"></i>
                è¿”å›ä¸»é¡µé¢
            </button>
            
            <div class="header">
                <h1 style="font-size: 16px;">ğŸ“¡ TALLY+é€šè¯</h1>
                <!-- åˆ é™¤äº†å‰¯æ ‡é¢˜ -->
            </div>
            
            <div class="tally-call-page-content">
                <!-- é€šè¯æ§åˆ¶åŒºåŸŸï¼ˆæå°é«˜åº¦ï¼‰ -->
                <div class="tally-call-controls-container">
                    <div class="tally-call-controls">
                        <div class="tally-call-buttons">
                            <button class="main-btn call-btn" id="tallyCallToggle">
                                <i class="fas fa-phone-alt"></i>
                                <span id="tallyCallText">åŠ å…¥é€šè¯</span>
                            </button>
                            <button class="main-btn mic-btn" id="tallyMicToggle" disabled>
                                <i class="fas fa-microphone"></i>
                                <span id="tallyMicText">å¼€å¯è¯ç­’</span>
                            </button>
                        </div>
                        
                        <div id="tallyCallStatus" class="tally-call-status">
                            <i class="fas fa-circle-notch fa-spin"></i>
                            <span id="tallyStatusText">æ­£åœ¨è¿æ¥...</span>
                        </div>
                    </div>
                </div>
                
                <!-- TALLYæ˜¾ç¤ºåŒºåŸŸï¼ˆä¸»è¦åŒºåŸŸï¼‰ -->
                <div class="tally-call-display-container">
                    <div class="tally-call-display">
                        <!-- iframeå°†åœ¨è¿™é‡ŒåŠ¨æ€åˆ›å»º -->
                    </div>
                </div>
            </div>
            
            <div class="footer">
                <p>ä¸ªäººè‡ªç ” æ¬¢è¿è¯•ç”¨</p>
            </div>
        </div>
    </div>

    <!-- å¼•å…¥å£°ç½‘ Web SDK -->
    <script src="https://download.agora.io/sdk/release/AgoraRTC_N-4.21.0.js"></script>
    <script>
        // é¡µé¢çŠ¶æ€ç®¡ç†å™¨
        const pageManager = {
            currentPage: 'main-page',
            callPageState: null,
            tallyState: {
                url: '',
                iframe: null,
                isInitialized: false
            },
            tallyCallState: null  // æ–°å¢ï¼šTALLY+é€šè¯é¡µé¢çŠ¶æ€
        };
        
        // é¡µé¢åˆ‡æ¢å‡½æ•°
        function showPage(pageId) {
            // éšè—æ‰€æœ‰é¡µé¢
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // æ˜¾ç¤ºç›®æ ‡é¡µé¢
            const targetPage = document.getElementById(pageId);
            targetPage.classList.add('active');
            
            // æ›´æ–°å½“å‰é¡µé¢è®°å½•
            pageManager.currentPage = pageId;
            
            // é¡µé¢ç‰¹å®šé€»è¾‘
            if (pageId === 'call-page' && pageManager.callPageState && pageManager.callPageState.isInCall) {
                // é€šè¯é¡µé¢å·²å¤„äºé€šè¯ä¸­ï¼Œæ›´æ–°æ˜¾ç¤º
                setTimeout(() => {
                    updateCallPageDisplay();
                    updateMembersDisplay();
                }, 100);
            }
            
            // TALLY+é€šè¯é¡µé¢ç‰¹å®šé€»è¾‘
            if (pageId === 'tally-call-page') {
                // å¦‚æœå·²ç»æœ‰TALLYç½‘å€ï¼Œç¡®ä¿iframeå­˜åœ¨
                if (pageManager.tallyCallState && pageManager.tallyCallState.tallyUrl) {
                    setTimeout(() => {
                        ensureTallyCallIframe(pageManager.tallyCallState.tallyUrl);
                    }, 50);
                }
                
                // å¦‚æœå·²å¤„äºé€šè¯ä¸­ï¼Œæ›´æ–°æ˜¾ç¤º
                if (pageManager.tallyCallState && pageManager.tallyCallState.isInCall) {
                    setTimeout(() => {
                        updateTallyCallPageDisplay();
                    }, 100);
                }
            }
        }
        
        // è¿”å›ä¸»é¡µé¢
        function goBack() {
            showPage('main-page');
        }
        
        // åˆ›å»ºæˆ–æ›´æ–°TALLYé¡µé¢iframe
        function setupTallyIframe(url) {
            const container = document.querySelector('#tally-page .tally-container');
            if (!container) {
                console.error('æ‰¾ä¸åˆ°TALLYå®¹å™¨');
                return;
            }
            
            // æ¸…ç©ºå®¹å™¨
            container.innerHTML = '';
            
            // åˆ›å»ºiframe
            const iframe = document.createElement('iframe');
            iframe.className = 'tally-frame';
            iframe.src = url;
            iframe.frameborder = "0";
            iframe.allow = "autoplay; encrypted-media; gyroscope; accelerometer";
            iframe.allowFullscreen = true;
            iframe.setAttribute('sandbox', 'allow-same-origin allow-scripts allow-popups allow-forms allow-modals');
            
            // è®¾ç½®iframeæ ·å¼ç¡®ä¿å…¨å±
            iframe.style.width = '100%';
            iframe.style.height = '100%';
            iframe.style.minHeight = '0';
            iframe.style.flex = '1';
            
            // æ·»åŠ åˆ°å®¹å™¨
            container.appendChild(iframe);
            
            // ä¿å­˜çŠ¶æ€
            pageManager.tallyState.url = url;
            pageManager.tallyState.iframe = iframe;
            pageManager.tallyState.isInitialized = true;
            
            console.log('TALLY iframeå·²åˆ›å»ºï¼ŒURL:', url);
            
            // ç›‘å¬iframeåŠ è½½å®Œæˆ
            iframe.onload = function() {
                console.log('TALLY iframeåŠ è½½å®Œæˆ');
            };
            
            iframe.onerror = function(e) {
                console.error('TALLY iframeåŠ è½½å¤±è´¥:', e);
                alert('TALLYé¡µé¢åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘å€æ˜¯å¦æ­£ç¡®');
            };
        }
        
        // ç¡®ä¿TALLY+é€šè¯é¡µé¢iframeå­˜åœ¨
        function ensureTallyCallIframe(url) {
            const container = document.querySelector('#tally-call-page .tally-call-display');
            if (!container) {
                console.error('æ‰¾ä¸åˆ°TALLY+é€šè¯å®¹å™¨');
                return;
            }
            
            // æ£€æŸ¥URLæ˜¯å¦å˜åŒ–
            const urlChanged = !pageManager.tallyCallState || pageManager.tallyCallState.tallyUrl !== url;
            
            // å¦‚æœURLæœªå˜åŒ–ä¸”å·²æœ‰iframeï¼Œç›´æ¥è¿”å›
            if (!urlChanged && pageManager.tallyCallState && pageManager.tallyCallState.tallyIframe) {
                // ç¡®ä¿iframeåœ¨å®¹å™¨ä¸­
                if (container && !container.contains(pageManager.tallyCallState.tallyIframe)) {
                    container.innerHTML = '';
                    container.appendChild(pageManager.tallyCallState.tallyIframe);
                }
                console.log('TALLY+é€šè¯ iframeå·²å­˜åœ¨ï¼ŒURLæœªå˜åŒ–ï¼Œç›´æ¥å¤ç”¨');
                return;
            }
            
            // æ¸…ç©ºå®¹å™¨
            container.innerHTML = '';
            
            // åˆ›å»ºiframe
            const iframe = document.createElement('iframe');
            iframe.className = 'tally-call-frame';
            iframe.src = url;
            iframe.frameborder = "0";
            iframe.allow = "autoplay; encrypted-media; gyroscope; accelerometer";
            iframe.allowFullscreen = true;
            iframe.setAttribute('sandbox', 'allow-same-origin allow-scripts allow-popups allow-forms allow-modals');
            
            // è®¾ç½®iframeæ ·å¼ç¡®ä¿å…¨å±
            iframe.style.width = '100%';
            iframe.style.height = '100%';
            iframe.style.minHeight = '0';
            iframe.style.flex = '1';
            iframe.style.display = 'block'; // ç¡®ä¿iframeæ˜¾ç¤º
            
            // æ·»åŠ åˆ°å®¹å™¨
            container.appendChild(iframe);
            
            // ä¿å­˜çŠ¶æ€
            if (pageManager.tallyCallState) {
                pageManager.tallyCallState.tallyUrl = url;
                pageManager.tallyCallState.tallyIframe = iframe;
                pageManager.tallyCallState.isTallyInitialized = true;
            }
            
            console.log('TALLY+é€šè¯ iframeå·²åˆ›å»ºï¼ŒURL:', url);
            
            // ç›‘å¬iframeåŠ è½½å®Œæˆ
            iframe.onload = function() {
                console.log('TALLY+é€šè¯ iframeåŠ è½½å®Œæˆ');
            };
            
            iframe.onerror = function(e) {
                console.error('TALLY+é€šè¯ iframeåŠ è½½å¤±è´¥:', e);
                alert('TALLYé¡µé¢åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘å€æ˜¯å¦æ­£ç¡®');
            };
        }
        
        // åˆå§‹åŒ–ä¸»é¡µé¢æŒ‰é’®äº‹ä»¶
        document.addEventListener('DOMContentLoaded', function() {
            // ä¸€çº§é¡µé¢æŒ‰é’®äº‹ä»¶
            document.getElementById('joinCallBtn').addEventListener('click', async function() {
                const channelName = document.getElementById('channelName').value.trim();
                const token = document.getElementById('tokenInput').value.trim();
                
                if (!channelName) {
                    alert('è¯·è¾“å…¥é¢‘é“åç§°ï¼');
                    return;
                }
                
                // è®¾ç½®å½“å‰é¢‘é“åç§°
                document.getElementById('currentChannel').textContent = channelName;
                
                // åˆ‡æ¢åˆ°é€šè¯é¡µé¢
                showPage('call-page');
                
                // å¦‚æœå½“å‰æ²¡æœ‰é€šè¯çŠ¶æ€æˆ–è€…ä¸åœ¨é€šè¯ä¸­ï¼Œåˆ™åŠ å…¥é¢‘é“
                if (!pageManager.callPageState || !pageManager.callPageState.isInCall) {
                    try {
                        await joinChannelFromMainPage(channelName, token);
                    } catch (error) {
                        console.error('åŠ å…¥é¢‘é“å¤±è´¥:', error);
                        alert(`åŠ å…¥é¢‘é“å¤±è´¥: ${error.message}`);
                        // å›åˆ°ä¸»é¡µé¢
                        showPage('main-page');
                    }
                }
            });
            
            document.getElementById('showTallyBtn').addEventListener('click', function() {
                const url = document.getElementById('urlInput').value.trim();
                
                if (!url) {
                    alert('è¯·è¾“å…¥TALLYç½‘å€ï¼');
                    return;
                }
                
                // éªŒè¯URLæ ¼å¼
                try {
                    new URL(url);
                } catch (e) {
                    alert('è¯·è¾“å…¥æœ‰æ•ˆçš„ç½‘å€ï¼ˆåŒ…å«http://æˆ–https://ï¼‰');
                    return;
                }
                
                // æ£€æŸ¥URLæ˜¯å¦å˜åŒ–
                const urlChanged = pageManager.tallyState.url !== url;
                
                // ä¿å­˜TALLYç½‘å€
                pageManager.tallyState.url = url;
                
                // åˆ‡æ¢åˆ°TALLYæ˜¾ç¤ºé¡µé¢
                showPage('tally-page');
                
                // åˆ›å»ºæˆ–æ›´æ–°iframe
                if (!pageManager.tallyState.isInitialized || urlChanged) {
                    // åˆ›å»ºæ–°çš„iframeï¼ˆURLå˜åŒ–æˆ–é¦–æ¬¡åˆ›å»ºï¼‰
                    setupTallyIframe(url);
                } else {
                    // URLæœªå˜åŒ–ï¼Œä½†éœ€è¦ç¡®ä¿iframeåœ¨æ­£ç¡®çš„ä½ç½®
                    const container = document.querySelector('#tally-page .tally-container');
                    const iframe = pageManager.tallyState.iframe;
                    if (container && iframe && !container.contains(iframe)) {
                        container.innerHTML = '';
                        container.appendChild(iframe);
                    }
                }
            });
            
            document.getElementById('tallyCallBtn').addEventListener('click', async function() {
                const channelName = document.getElementById('channelName').value.trim();
                const token = document.getElementById('tokenInput').value.trim();
                const url = document.getElementById('urlInput').value.trim();
                
                if (!channelName) {
                    alert('è¯·è¾“å…¥é¢‘é“åç§°ï¼');
                    return;
                }
                
                if (!url) {
                    alert('è¯·è¾“å…¥TALLYç½‘å€ï¼');
                    return;
                }
                
                // éªŒè¯URLæ ¼å¼
                try {
                    new URL(url);
                } catch (e) {
                    alert('è¯·è¾“å…¥æœ‰æ•ˆçš„ç½‘å€ï¼ˆåŒ…å«http://æˆ–https://ï¼‰');
                    return;
                }
                
                // åˆ‡æ¢åˆ°TALLY+é€šè¯é¡µé¢
                showPage('tally-call-page');
                
                // è®¾ç½®TALLYæ˜¾ç¤º
                ensureTallyCallIframe(url);
                
                // å¦‚æœå½“å‰æ²¡æœ‰é€šè¯çŠ¶æ€æˆ–è€…ä¸åœ¨é€šè¯ä¸­ï¼Œåˆ™åŠ å…¥é¢‘é“
                if (!pageManager.tallyCallState || !pageManager.tallyCallState.isInCall) {
                    try {
                        await joinTallyCallChannel(channelName, token);
                    } catch (error) {
                        console.error('åŠ å…¥é¢‘é“å¤±è´¥:', error);
                        alert(`åŠ å…¥é¢‘é“å¤±è´¥: ${error.message}`);
                        // å›åˆ°ä¸»é¡µé¢
                        showPage('main-page');
                    }
                }
            });
            
            // åˆå§‹åŒ–é€šè¯é¡µé¢
            initCallPage();
            
            // åˆå§‹åŒ–TALLY+é€šè¯é¡µé¢
            initTallyCallPage();
            
            console.log('é¡µé¢åˆå§‹åŒ–å®Œæˆ');
        });
        
        // ========== é€šè¯é¡µé¢åŠŸèƒ½ï¼ˆäºŒçº§é¡µé¢1ï¼‰ ==========
        // åˆå§‹åŒ–é€šè¯é¡µé¢çŠ¶æ€
        if (!pageManager.callPageState) {
            pageManager.callPageState = {
                rtcClient: null,
                localAudioTrack: null,
                isPublished: false,
                isMicrophoneMuted: true,
                isInCall: false,
                members: new Map(),
                currentChannelName: '',
                currentUid: null
            };
        }
        
        const APP_ID = "4531524ecba946fd868fc547c6d269d7";
        
        // åˆå§‹åŒ–é€šè¯é¡µé¢
        function initCallPage() {
            // ç»‘å®šé€šè¯é¡µé¢çš„äº‹ä»¶ç›‘å¬å™¨
            const callToggleBtn = document.getElementById('callToggle');
            const micToggleBtn = document.getElementById('micToggle');
            
            if (callToggleBtn) {
                callToggleBtn.addEventListener('click', toggleCall);
            }
            
            if (micToggleBtn) {
                micToggleBtn.addEventListener('click', toggleMicrophone);
            }
            
            console.log('é€šè¯é¡µé¢åˆå§‹åŒ–å®Œæˆ');
        }
        
        // ä»ä¸»é¡µé¢åŠ å…¥é¢‘é“
        async function joinChannelFromMainPage(channelName, token = null) {
            // æ£€æµ‹éº¦å…‹é£æƒé™
            const hasMicPerm = await checkMicPermission();
            if (!hasMicPerm) {
                throw new Error('éº¦å…‹é£æƒé™è¢«æ‹’ç»');
            }
            
            try {
                // æ›´æ–°é€šè¯çŠ¶æ€æ˜¾ç¤º
                updateCallStatus('connecting', 'æ­£åœ¨åŠ å…¥é¢‘é“...');
                
                // åˆå§‹åŒ–å£°ç½‘å®¢æˆ·ç«¯
                await initRtcClient();
                
                // åˆ›å»ºéº¦å…‹é£éŸ³é¢‘è½¨é“
                const audioTrack = await createMicrophoneAudioTrack();
                
                if (!audioTrack || !audioTrack.play) {
                    throw new Error("éŸ³é¢‘è½¨é“åˆ›å»ºå¤±è´¥");
                }
                
                pageManager.callPageState.localAudioTrack = audioTrack;
                console.log(`éº¦å…‹é£éŸ³é¢‘è½¨é“åˆ›å»ºæˆåŠŸ`);
                
                // åŠ å…¥é¢‘é“
                const uid = await pageManager.callPageState.rtcClient.join(APP_ID, channelName, token || null);
                console.log(`åŠ å…¥é¢‘é“ã€${channelName}ã€‘æˆåŠŸï¼ŒUID: ${uid}`);
                
                pageManager.callPageState.currentUid = uid;
                pageManager.callPageState.currentChannelName = channelName;
                
                // æ·»åŠ æœ¬åœ°æˆå‘˜åˆ°åˆ—è¡¨
                addMember(uid, true, pageManager.callPageState.localAudioTrack);
                
                // å‘å¸ƒéŸ³é¢‘
                await pageManager.callPageState.rtcClient.publish([pageManager.callPageState.localAudioTrack]);
                pageManager.callPageState.isPublished = true;
                console.log("æœ¬åœ°éŸ³é¢‘å‘å¸ƒæˆåŠŸ");
                
                // é»˜è®¤å…³é—­è¯ç­’
                pageManager.callPageState.isMicrophoneMuted = true;
                pageManager.callPageState.localAudioTrack.setEnabled(false);
                
                // è®¾ç½®é€šè¯çŠ¶æ€
                pageManager.callPageState.isInCall = true;
                
                // æ›´æ–°æœ¬åœ°æˆå‘˜çŠ¶æ€
                const localMember = Array.from(pageManager.callPageState.members.values()).find(m => m.isLocal);
                if (localMember) {
                    localMember.isMuted = true;
                }
                
                // æ›´æ–°é€šè¯é¡µé¢æ˜¾ç¤º
                updateCallPageDisplay();
                updateMembersDisplay();
                
                // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
                updateCallStatus('connected', `å·²åŠ å…¥é¢‘é“ï¼š${channelName} | UIDï¼š${uid}`);
                
                return uid;
                
            } catch (error) {
                console.error("åŠ å…¥/å‘å¸ƒå¤±è´¥:", error);
                
                // æ¸…ç†èµ„æº
                if (pageManager.callPageState.localAudioTrack) {
                    pageManager.callPageState.localAudioTrack.close();
                    pageManager.callPageState.localAudioTrack = null;
                }
                
                if (pageManager.callPageState.rtcClient) {
                    pageManager.callPageState.rtcClient = null;
                }
                
                pageManager.callPageState.isPublished = false;
                pageManager.callPageState.isInCall = false;
                pageManager.callPageState.members.clear();
                
                updateCallPageDisplay();
                updateCallStatus('error', `åŠ å…¥é¢‘é“å¤±è´¥ï¼š${error.message}`);
                
                throw error;
            }
        }
        
        // æ›´æ–°é€šè¯é¡µé¢æ˜¾ç¤º
        function updateCallPageDisplay() {
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            const callToggleBtn = document.getElementById('callToggle');
            const micToggleBtn = document.getElementById('micToggle');
            const callTextSpan = document.getElementById('callText');
            const micTextSpan = document.getElementById('micText');
            
            if (callToggleBtn && callTextSpan) {
                if (pageManager.callPageState.isInCall) {
                    callToggleBtn.classList.add('in-call');
                    callTextSpan.textContent = 'é€€å‡ºé€šè¯';
                    callToggleBtn.querySelector('i').className = 'fas fa-phone-slash';
                } else {
                    callToggleBtn.classList.remove('in-call');
                    callTextSpan.textContent = 'åŠ å…¥é€šè¯';
                    callToggleBtn.querySelector('i').className = 'fas fa-phone-alt';
                }
            }
            
            if (micToggleBtn && micTextSpan) {
                micToggleBtn.disabled = !pageManager.callPageState.isInCall;
                if (pageManager.callPageState.isMicrophoneMuted) {
                    micTextSpan.textContent = 'å¼€å¯è¯ç­’';
                    micToggleBtn.classList.remove('muted');
                    micToggleBtn.querySelector('i').className = 'fas fa-microphone';
                } else {
                    micTextSpan.textContent = 'å…³é—­è¯ç­’';
                    micToggleBtn.classList.add('muted');
                    micToggleBtn.querySelector('i').className = 'fas fa-microphone-slash';
                }
            }
        }
        
        // åˆå§‹åŒ–å®¢æˆ·ç«¯
        async function initRtcClient() {
            if (pageManager.callPageState.rtcClient) return;
            
            try {
                const rtcClient = AgoraRTC.createClient({ mode: "rtc", codec: "vp8" });
                pageManager.callPageState.rtcClient = rtcClient;
                
                // ç›‘å¬è¿œç¨‹ç”¨æˆ·åŠ å…¥
                rtcClient.on("user-published", async (user, mediaType) => {
                    try {
                        await rtcClient.subscribe(user, mediaType);
                        if (mediaType === "audio") {
                            const remoteAudioTrack = user.audioTrack;
                            remoteAudioTrack.play();
                            
                            // æ·»åŠ è¿œç¨‹æˆå‘˜åˆ°åˆ—è¡¨
                            addMember(user.uid, false, remoteAudioTrack);
                            updateMembersDisplay();
                            console.log(`å·²è®¢é˜…è¿œç¨‹ç”¨æˆ· ${user.uid} çš„éŸ³é¢‘`);
                        }
                    } catch (subscribeErr) {
                        console.error("è®¢é˜…è¿œç¨‹ç”¨æˆ·å¤±è´¥ï¼š", subscribeErr);
                    }
                });
                
                // ç›‘å¬ç”¨æˆ·å–æ¶ˆå‘å¸ƒ
                rtcClient.on("user-unpublished", (user, mediaType) => {
                    const member = pageManager.callPageState.members.get(user.uid.toString());
                    if (member && !member.isLocal) {
                        member.isMuted = true;
                        updateMembersDisplay();
                        console.log(`ç”¨æˆ· ${user.uid} å·²å…³é—­éº¦å…‹é£`);
                    }
                });
                
                // ç›‘å¬ç”¨æˆ·ç¦»å¼€é¢‘é“
                rtcClient.on("user-left", (user) => {
                    removeMember(user.uid);
                    updateMembersDisplay();
                    console.log(`ç”¨æˆ· ${user.uid} å·²ç¦»å¼€é¢‘é“`);
                });
                
                // ç›‘å¬ç”¨æˆ·é‡æ–°å‘å¸ƒåª’ä½“æµ
                rtcClient.on("user-published", async (user, mediaType) => {
                    if (mediaType === "audio" && pageManager.callPageState.members.has(user.uid.toString())) {
                        try {
                            await rtcClient.subscribe(user, mediaType);
                            const remoteAudioTrack = user.audioTrack;
                            remoteAudioTrack.play();
                            
                            const member = pageManager.callPageState.members.get(user.uid.toString());
                            if (member) {
                                member.audioTrack = remoteAudioTrack;
                                member.isMuted = false;
                                updateMembersDisplay();
                                console.log(`ç”¨æˆ· ${user.uid} é‡æ–°å¼€å¯éº¦å…‹é£`);
                            }
                        } catch (subscribeErr) {
                            console.error("é‡æ–°è®¢é˜…ç”¨æˆ·å¤±è´¥ï¼š", subscribeErr);
                        }
                    }
                });
                
            } catch (initErr) {
                console.error("å®¢æˆ·ç«¯åˆå§‹åŒ–å¤±è´¥ï¼š", initErr);
                throw initErr;
            }
        }
        
        // åˆ›å»ºéº¦å…‹é£éŸ³é¢‘è½¨é“
        async function createMicrophoneAudioTrack() {
            try {
                // ä½¿ç”¨æµè§ˆå™¨é»˜è®¤éº¦å…‹é£ï¼Œå¯ç”¨éŸ³é¢‘å¤„ç†
                return await AgoraRTC.createMicrophoneAudioTrack({
                    encoderConfig: 'music_standard',
                    AEC: true,  // å›å£°æ¶ˆé™¤
                    ANS: true,  // å™ªå£°æŠ‘åˆ¶
                    AGC: true   // è‡ªåŠ¨å¢ç›Šæ§åˆ¶
                });
            } catch (error) {
                console.error('åˆ›å»ºéº¦å…‹é£éŸ³é¢‘è½¨é“å¤±è´¥:', error);
                throw error;
            }
        }
        
        // æ·»åŠ æˆå‘˜
        function addMember(uid, isLocal = false, audioTrack = null) {
            if (pageManager.callPageState.members.has(uid.toString())) {
                const existingMember = pageManager.callPageState.members.get(uid.toString());
                existingMember.audioTrack = audioTrack;
                existingMember.isMuted = false;
            } else {
                const member = {
                    uid: uid,
                    isLocal: isLocal,
                    audioTrack: audioTrack,
                    isMuted: false,
                    isSpeaking: false
                };
                pageManager.callPageState.members.set(uid.toString(), member);
            }
        }
        
        // ç§»é™¤æˆå‘˜
        function removeMember(uid) {
            pageManager.callPageState.members.delete(uid.toString());
        }
        
        // æ›´æ–°æˆå‘˜æ˜¾ç¤º
        function updateMembersDisplay() {
            const membersListDiv = document.getElementById('membersList');
            const memberCountSpan = document.getElementById('memberCount');
            
            if (!membersListDiv || !memberCountSpan) {
                console.warn('æˆå‘˜åˆ—è¡¨å…ƒç´ æœªæ‰¾åˆ°');
                return;
            }
            
            if (pageManager.callPageState.members.size === 0) {
                membersListDiv.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-user-friends"></i>
                        <p>é¢‘é“å†…æš‚æ— æˆå‘˜</p>
                        <p style="font-size: 11px; margin-top: 5px;">åŠ å…¥é¢‘é“åï¼Œæˆå‘˜åˆ—è¡¨å°†åœ¨è¿™é‡Œæ˜¾ç¤º</p>
                    </div>
                `;
                memberCountSpan.textContent = "0";
                return;
            }
            
            memberCountSpan.textContent = pageManager.callPageState.members.size.toString();
            
            let membersHTML = "";
            
            pageManager.callPageState.members.forEach(member => {
                const isLocal = member.isLocal;
                const uid = member.uid;
                
                const colors = ['#667eea', '#764ba2', '#4CAF50', '#FF9800', '#E91E63', '#9C27B0'];
                const colorIndex = parseInt(uid) % colors.length || 0;
                
                let statusClass = "status-online";
                let statusText = "åœ¨çº¿";
                let statusIcon = "fa-circle";
                
                let isActuallyMuted = member.isMuted;
                if (isLocal) {
                    isActuallyMuted = pageManager.callPageState.isMicrophoneMuted;
                }
                
                if (isActuallyMuted) {
                    statusClass = "status-muted";
                    statusText = "å·²é™éŸ³";
                    statusIcon = "fa-microphone-slash";
                } else if (member.isSpeaking) {
                    statusClass = "status-speaker";
                    statusText = "æ­£åœ¨å‘è¨€";
                    statusIcon = "fa-volume-up";
                }
                
                const muteIcon = isActuallyMuted ? 'fa-microphone-slash' : 'fa-microphone';
                const muteTitle = isActuallyMuted ? 'å–æ¶ˆé™éŸ³' : 'é™éŸ³';
                const muteBtnClass = isActuallyMuted ? 'mute-btn muted' : 'mute-btn';
                
                membersHTML += `
                    <div class="member-card ${isLocal ? 'local' : ''}">
                        <div class="avatar ${isLocal ? 'local' : 'remote'}" style="background: ${colors[colorIndex]}">
                            ${isLocal ? 'æˆ‘' : 'ç”¨æˆ·'}
                        </div>
                        <div class="member-info">
                            <div class="member-name">
                                ${isLocal ? 'æˆ‘ (æœ¬åœ°)' : `ç”¨æˆ· ${uid}`}
                            </div>
                            <div class="member-uid">UID: ${uid}</div>
                            <div class="member-status ${statusClass}">
                                <i class="fas ${statusIcon}"></i>
                                ${statusText}
                            </div>
                        </div>
                        <div class="member-actions">
                            <button class="action-btn ${muteBtnClass}" 
                                    onclick="callPageToggleMemberMute('${uid}')" 
                                    title="${muteTitle}"
                                    ${isLocal ? 'disabled' : ''}>
                                <i class="fas ${muteIcon}"></i>
                            </button>
                        </div>
                    </div>
                `;
            });
            
            membersListDiv.innerHTML = membersHTML;
        }
        
        // åˆ‡æ¢æˆå‘˜é™éŸ³ï¼ˆé€šè¯é¡µé¢ï¼‰
        window.callPageToggleMemberMute = function(uid) {
            const member = pageManager.callPageState.members.get(uid);
            if (!member) return;
            
            if (member.isLocal) {
                toggleMicrophone();
            } else {
                if (member.audioTrack) {
                    if (member.isMuted) {
                        member.audioTrack.play();
                    } else {
                        member.audioTrack.stop();
                    }
                    member.isMuted = !member.isMuted;
                    updateMembersDisplay();
                }
            }
        };
        
        // æ£€æµ‹éº¦å…‹é£æƒé™
        async function checkMicPermission() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                stream.getTracks().forEach(track => track.stop());
                return true;
            } catch (e) {
                console.error("éº¦å…‹é£æƒé™å¤±è´¥ï¼š", e);
                throw new Error(`éº¦å…‹é£æƒé™æ£€æµ‹å¤±è´¥ï¼š${e.message}`);
            }
        }
        
        // æ›´æ–°é€šè¯çŠ¶æ€æ˜¾ç¤º
        function updateCallStatus(status, message) {
            const callStatusDiv = document.getElementById('callStatus');
            const statusTextSpan = document.getElementById('statusText');
            
            if (!callStatusDiv || !statusTextSpan) return;
            
            callStatusDiv.style.display = 'block';
            callStatusDiv.className = 'call-status';
            
            if (status === 'connecting') {
                statusTextSpan.innerHTML = `<i class="fas fa-circle-notch fa-spin"></i> ${message}`;
            } else if (status === 'connected') {
                callStatusDiv.classList.add('connected');
                statusTextSpan.innerHTML = `<i class="fas fa-check-circle"></i> ${message}`;
            } else if (status === 'disconnected') {
                callStatusDiv.classList.add('disconnected');
                statusTextSpan.innerHTML = `<i class="fas fa-times-circle"></i> ${message}`;
            } else if (status === 'error') {
                callStatusDiv.classList.add('disconnected');
                statusTextSpan.innerHTML = `<i class="fas fa-exclamation-circle"></i> ${message}`;
            }
            
            if (status === 'connected' || status === 'error') {
                setTimeout(() => {
                    if (callStatusDiv && (callStatusDiv.classList.contains('connected') || 
                         callStatusDiv.classList.contains('disconnected'))) {
                        callStatusDiv.style.display = 'none';
                    }
                }, 5000);
            }
        }
        
        // åˆ‡æ¢é€šè¯çŠ¶æ€ï¼ˆåœ¨é€šè¯é¡µé¢ï¼‰
        async function toggleCall() {
            const callToggleBtn = document.getElementById('callToggle');
            const micToggleBtn = document.getElementById('micToggle');
            
            if (!callToggleBtn || !micToggleBtn) return;
            
            if (pageManager.callPageState.isInCall) {
                await leaveChannel();
            } else {
                // åœ¨é€šè¯é¡µé¢æ‰‹åŠ¨åŠ å…¥é¢‘é“ï¼ˆå¤‡ç”¨åŠŸèƒ½ï¼‰
                const channelName = document.getElementById('currentChannel').textContent;
                if (!channelName) {
                    alert("é¢‘é“åç§°æœªè®¾ç½®ï¼");
                    return;
                }
                
                const token = document.getElementById('tokenInput') ? 
                             document.getElementById('tokenInput').value.trim() : '';
                
                try {
                    await joinChannelFromMainPage(channelName, token);
                } catch (error) {
                    alert(`åŠ å…¥é¢‘é“å¤±è´¥: ${error.message}`);
                }
            }
        }
        
        // åˆ‡æ¢éº¦å…‹é£å¼€å…³
        function toggleMicrophone() {
            if (!pageManager.callPageState.localAudioTrack) return;
            
            const micToggleBtn = document.getElementById('micToggle');
            const micTextSpan = document.getElementById('micText');
            
            if (pageManager.callPageState.isMicrophoneMuted) {
                pageManager.callPageState.localAudioTrack.setEnabled(true);
                pageManager.callPageState.isMicrophoneMuted = false;
                console.log("éº¦å…‹é£å·²å¼€å¯");
            } else {
                pageManager.callPageState.localAudioTrack.setEnabled(false);
                pageManager.callPageState.isMicrophoneMuted = true;
                console.log("éº¦å…‹é£å·²å…³é—­");
            }
            
            // æ›´æ–°æœ¬åœ°æˆå‘˜çŠ¶æ€
            const localMember = Array.from(pageManager.callPageState.members.values()).find(m => m.isLocal);
            if (localMember) {
                localMember.isMuted = pageManager.callPageState.isMicrophoneMuted;
            }
            
            updateMembersDisplay();
            updateCallPageDisplay();
        }
        
        // é€€å‡ºé¢‘é“
        async function leaveChannel() {
            try {
                updateCallStatus('connecting', 'æ­£åœ¨ç¦»å¼€é¢‘é“...');
                
                const callToggleBtn = document.getElementById('callToggle');
                if (callToggleBtn) {
                    callToggleBtn.disabled = true;
                }
                
                if (pageManager.callPageState.localAudioTrack) {
                    pageManager.callPageState.localAudioTrack.close();
                    pageManager.callPageState.localAudioTrack = null;
                    console.log("æœ¬åœ°éŸ³é¢‘è½¨é“å·²é‡Šæ”¾");
                }
                
                if (pageManager.callPageState.rtcClient) {
                    await pageManager.callPageState.rtcClient.leave();
                    pageManager.callPageState.rtcClient = null;
                    console.log("å·²é€€å‡ºé¢‘é“");
                }
                
                pageManager.callPageState.members.clear();
                pageManager.callPageState.isPublished = false;
                pageManager.callPageState.isMicrophoneMuted = true;
                pageManager.callPageState.isInCall = false;
                pageManager.callPageState.currentChannelName = '';
                pageManager.callPageState.currentUid = null;
                
                updateMembersDisplay();
                updateCallPageDisplay();
                
                if (callToggleBtn) {
                    callToggleBtn.disabled = false;
                }
                
                updateCallStatus('disconnected', 'å·²é€€å‡ºé€šè¯');
                
            } catch (leaveErr) {
                console.error("é€€å‡ºé¢‘é“å¤±è´¥ï¼š", leaveErr);
                updateCallStatus('error', `é€€å‡ºé€šè¯å¤±è´¥ï¼š${leaveErr.message}`);
                
                const callToggleBtn = document.getElementById('callToggle');
                if (callToggleBtn) {
                    callToggleBtn.disabled = false;
                }
            }
        }
        
        // ========== TALLY+é€šè¯é¡µé¢åŠŸèƒ½ï¼ˆäºŒçº§é¡µé¢3ï¼‰ ==========
        // åˆå§‹åŒ–TALLY+é€šè¯é¡µé¢çŠ¶æ€
        if (!pageManager.tallyCallState) {
            pageManager.tallyCallState = {
                rtcClient: null,
                localAudioTrack: null,
                isPublished: false,
                isMicrophoneMuted: true,
                isInCall: false,
                tallyUrl: '',
                tallyIframe: null,
                isTallyInitialized: false,
                currentChannelName: '',
                currentUid: null
            };
        }
        
        // åˆå§‹åŒ–TALLY+é€šè¯é¡µé¢
        function initTallyCallPage() {
            // ç»‘å®šTALLY+é€šè¯é¡µé¢çš„äº‹ä»¶ç›‘å¬å™¨
            const tallyCallToggleBtn = document.getElementById('tallyCallToggle');
            const tallyMicToggleBtn = document.getElementById('tallyMicToggle');
            
            if (tallyCallToggleBtn) {
                tallyCallToggleBtn.addEventListener('click', toggleTallyCall);
            }
            
            if (tallyMicToggleBtn) {
                tallyMicToggleBtn.addEventListener('click', toggleTallyMicrophone);
            }
            
            console.log('TALLY+é€šè¯é¡µé¢åˆå§‹åŒ–å®Œæˆ');
        }
        
        // åŠ å…¥TALLY+é€šè¯é¢‘é“
        async function joinTallyCallChannel(channelName, token = null) {
            // æ£€æµ‹éº¦å…‹é£æƒé™
            const hasMicPerm = await checkMicPermission();
            if (!hasMicPerm) {
                throw new Error('éº¦å…‹é£æƒé™è¢«æ‹’ç»');
            }
            
            try {
                // æ›´æ–°é€šè¯çŠ¶æ€æ˜¾ç¤º
                updateTallyCallStatus('connecting', 'æ­£åœ¨åŠ å…¥é¢‘é“...');
                
                // åˆå§‹åŒ–å£°ç½‘å®¢æˆ·ç«¯
                await initTallyCallRtcClient();
                
                // åˆ›å»ºéº¦å…‹é£éŸ³é¢‘è½¨é“
                const audioTrack = await createMicrophoneAudioTrack();
                
                if (!audioTrack || !audioTrack.play) {
                    throw new Error("éŸ³é¢‘è½¨é“åˆ›å»ºå¤±è´¥");
                }
                
                pageManager.tallyCallState.localAudioTrack = audioTrack;
                console.log(`TALLY+é€šè¯ï¼šéº¦å…‹é£éŸ³é¢‘è½¨é“åˆ›å»ºæˆåŠŸ`);
                
                // åŠ å…¥é¢‘é“
                const uid = await pageManager.tallyCallState.rtcClient.join(APP_ID, channelName, token || null);
                console.log(`TALLY+é€šè¯ï¼šåŠ å…¥é¢‘é“ã€${channelName}ã€‘æˆåŠŸï¼ŒUID: ${uid}`);
                
                pageManager.tallyCallState.currentUid = uid;
                pageManager.tallyCallState.currentChannelName = channelName;
                
                // å‘å¸ƒéŸ³é¢‘
                await pageManager.tallyCallState.rtcClient.publish([pageManager.tallyCallState.localAudioTrack]);
                pageManager.tallyCallState.isPublished = true;
                console.log("TALLY+é€šè¯ï¼šæœ¬åœ°éŸ³é¢‘å‘å¸ƒæˆåŠŸ");
                
                // é»˜è®¤å…³é—­è¯ç­’
                pageManager.tallyCallState.isMicrophoneMuted = true;
                pageManager.tallyCallState.localAudioTrack.setEnabled(false);
                
                // è®¾ç½®é€šè¯çŠ¶æ€
                pageManager.tallyCallState.isInCall = true;
                
                // æ›´æ–°TALLY+é€šè¯é¡µé¢æ˜¾ç¤º
                updateTallyCallPageDisplay();
                
                // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
                updateTallyCallStatus('connected', `å·²åŠ å…¥é¢‘é“ï¼š${channelName} | UIDï¼š${uid}`);
                
                return uid;
                
            } catch (error) {
                console.error("TALLY+é€šè¯ï¼šåŠ å…¥/å‘å¸ƒå¤±è´¥:", error);
                
                // æ¸…ç†èµ„æº
                if (pageManager.tallyCallState.localAudioTrack) {
                    pageManager.tallyCallState.localAudioTrack.close();
                    pageManager.tallyCallState.localAudioTrack = null;
                }
                
                if (pageManager.tallyCallState.rtcClient) {
                    pageManager.tallyCallState.rtcClient = null;
                }
                
                pageManager.tallyCallState.isPublished = false;
                pageManager.tallyCallState.isInCall = false;
                
                updateTallyCallPageDisplay();
                updateTallyCallStatus('error', `åŠ å…¥é¢‘é“å¤±è´¥ï¼š${error.message}`);
                
                throw error;
            }
        }
        
        // æ›´æ–°TALLY+é€šè¯é¡µé¢æ˜¾ç¤º
        function updateTallyCallPageDisplay() {
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            const tallyCallToggleBtn = document.getElementById('tallyCallToggle');
            const tallyMicToggleBtn = document.getElementById('tallyMicToggle');
            const tallyCallTextSpan = document.getElementById('tallyCallText');
            const tallyMicTextSpan = document.getElementById('tallyMicText');
            
            if (tallyCallToggleBtn && tallyCallTextSpan) {
                if (pageManager.tallyCallState.isInCall) {
                    tallyCallToggleBtn.classList.add('in-call');
                    tallyCallTextSpan.textContent = 'é€€å‡ºé€šè¯';
                    tallyCallToggleBtn.querySelector('i').className = 'fas fa-phone-slash';
                } else {
                    tallyCallToggleBtn.classList.remove('in-call');
                    tallyCallTextSpan.textContent = 'åŠ å…¥é€šè¯';
                    tallyCallToggleBtn.querySelector('i').className = 'fas fa-phone-alt';
                }
            }
            
            if (tallyMicToggleBtn && tallyMicTextSpan) {
                tallyMicToggleBtn.disabled = !pageManager.tallyCallState.isInCall;
                if (pageManager.tallyCallState.isMicrophoneMuted) {
                    tallyMicTextSpan.textContent = 'å¼€å¯è¯ç­’';
                    tallyMicToggleBtn.classList.remove('muted');
                    tallyMicToggleBtn.querySelector('i').className = 'fas fa-microphone';
                } else {
                    tallyMicTextSpan.textContent = 'å…³é—­è¯ç­’';
                    tallyMicToggleBtn.classList.add('muted');
                    tallyMicToggleBtn.querySelector('i').className = 'fas fa-microphone-slash';
                }
            }
        }
        
        // åˆå§‹åŒ–TALLY+é€šè¯å®¢æˆ·ç«¯
        async function initTallyCallRtcClient() {
            if (pageManager.tallyCallState.rtcClient) return;
            
            try {
                const rtcClient = AgoraRTC.createClient({ mode: "rtc", codec: "vp8" });
                pageManager.tallyCallState.rtcClient = rtcClient;
                
                // ç›‘å¬è¿œç¨‹ç”¨æˆ·åŠ å…¥
                rtcClient.on("user-published", async (user, mediaType) => {
                    try {
                        await rtcClient.subscribe(user, mediaType);
                        if (mediaType === "audio") {
                            const remoteAudioTrack = user.audioTrack;
                            remoteAudioTrack.play();
                            console.log(`TALLY+é€šè¯ï¼šå·²è®¢é˜…è¿œç¨‹ç”¨æˆ· ${user.uid} çš„éŸ³é¢‘`);
                        }
                    } catch (subscribeErr) {
                        console.error("TALLY+é€šè¯ï¼šè®¢é˜…è¿œç¨‹ç”¨æˆ·å¤±è´¥ï¼š", subscribeErr);
                    }
                });
                
                // ç›‘å¬ç”¨æˆ·å–æ¶ˆå‘å¸ƒ
                rtcClient.on("user-unpublished", (user, mediaType) => {
                    console.log(`TALLY+é€šè¯ï¼šç”¨æˆ· ${user.uid} å·²å…³é—­éº¦å…‹é£`);
                });
                
                // ç›‘å¬ç”¨æˆ·ç¦»å¼€é¢‘é“
                rtcClient.on("user-left", (user) => {
                    console.log(`TALLY+é€šè¯ï¼šç”¨æˆ· ${user.uid} å·²ç¦»å¼€é¢‘é“`);
                });
                
            } catch (initErr) {
                console.error("TALLY+é€šè¯ï¼šå®¢æˆ·ç«¯åˆå§‹åŒ–å¤±è´¥ï¼š", initErr);
                throw initErr;
            }
        }
        
        // æ›´æ–°TALLY+é€šè¯çŠ¶æ€æ˜¾ç¤º
        function updateTallyCallStatus(status, message) {
            const tallyCallStatusDiv = document.getElementById('tallyCallStatus');
            const tallyStatusTextSpan = document.getElementById('tallyStatusText');
            
            if (!tallyCallStatusDiv || !tallyStatusTextSpan) return;
            
            tallyCallStatusDiv.style.display = 'block';
            tallyCallStatusDiv.className = 'tally-call-status';
            
            if (status === 'connecting') {
                tallyStatusTextSpan.innerHTML = `<i class="fas fa-circle-notch fa-spin"></i> ${message}`;
            } else if (status === 'connected') {
                tallyCallStatusDiv.classList.add('connected');
                tallyStatusTextSpan.innerHTML = `<i class="fas fa-check-circle"></i> ${message}`;
            } else if (status === 'disconnected') {
                tallyCallStatusDiv.classList.add('disconnected');
                tallyStatusTextSpan.innerHTML = `<i class="fas fa-times-circle"></i> ${message}`;
            } else if (status === 'error') {
                tallyCallStatusDiv.classList.add('disconnected');
                tallyStatusTextSpan.innerHTML = `<i class="fas fa-exclamation-circle"></i> ${message}`;
            }
            
            if (status === 'connected' || status === 'error') {
                setTimeout(() => {
                    if (tallyCallStatusDiv && (tallyCallStatusDiv.classList.contains('connected') || 
                         tallyCallStatusDiv.classList.contains('disconnected'))) {
                        tallyCallStatusDiv.style.display = 'none';
                    }
                }, 5000);
            }
        }
        
        // åˆ‡æ¢TALLY+é€šè¯çŠ¶æ€
        async function toggleTallyCall() {
            const tallyCallToggleBtn = document.getElementById('tallyCallToggle');
            const tallyMicToggleBtn = document.getElementById('tallyMicToggle');
            
            if (!tallyCallToggleBtn || !tallyMicToggleBtn) return;
            
            if (pageManager.tallyCallState.isInCall) {
                await leaveTallyCallChannel();
            } else {
                // åœ¨TALLY+é€šè¯é¡µé¢æ‰‹åŠ¨åŠ å…¥é¢‘é“
                const channelName = document.getElementById('channelName').value.trim();
                if (!channelName) {
                    alert("è¯·åœ¨ä¸»é¡µé¢è¾“å…¥é¢‘é“åç§°ï¼");
                    return;
                }
                
                const token = document.getElementById('tokenInput') ? 
                             document.getElementById('tokenInput').value.trim() : '';
                
                try {
                    await joinTallyCallChannel(channelName, token);
                } catch (error) {
                    alert(`åŠ å…¥é¢‘é“å¤±è´¥: ${error.message}`);
                }
            }
        }
        
        // åˆ‡æ¢TALLY+é€šè¯éº¦å…‹é£å¼€å…³
        function toggleTallyMicrophone() {
            if (!pageManager.tallyCallState.localAudioTrack) return;
            
            const tallyMicToggleBtn = document.getElementById('tallyMicToggle');
            const tallyMicTextSpan = document.getElementById('tallyMicText');
            
            if (pageManager.tallyCallState.isMicrophoneMuted) {
                pageManager.tallyCallState.localAudioTrack.setEnabled(true);
                pageManager.tallyCallState.isMicrophoneMuted = false;
                console.log("TALLY+é€šè¯ï¼šéº¦å…‹é£å·²å¼€å¯");
            } else {
                pageManager.tallyCallState.localAudioTrack.setEnabled(false);
                pageManager.tallyCallState.isMicrophoneMuted = true;
                console.log("TALLY+é€šè¯ï¼šéº¦å…‹é£å·²å…³é—­");
            }
            
            updateTallyCallPageDisplay();
        }
        
        // é€€å‡ºTALLY+é€šè¯é¢‘é“
        async function leaveTallyCallChannel() {
            try {
                updateTallyCallStatus('connecting', 'æ­£åœ¨ç¦»å¼€é¢‘é“...');
                
                const tallyCallToggleBtn = document.getElementById('tallyCallToggle');
                if (tallyCallToggleBtn) {
                    tallyCallToggleBtn.disabled = true;
                }
                
                if (pageManager.tallyCallState.localAudioTrack) {
                    pageManager.tallyCallState.localAudioTrack.close();
                    pageManager.tallyCallState.localAudioTrack = null;
                    console.log("TALLY+é€šè¯ï¼šæœ¬åœ°éŸ³é¢‘è½¨é“å·²é‡Šæ”¾");
                }
                
                if (pageManager.tallyCallState.rtcClient) {
                    await pageManager.tallyCallState.rtcClient.leave();
                    pageManager.tallyCallState.rtcClient = null;
                    console.log("TALLY+é€šè¯ï¼šå·²é€€å‡ºé¢‘é“");
                }
                
                pageManager.tallyCallState.isPublished = false;
                pageManager.tallyCallState.isMicrophoneMuted = true;
                pageManager.tallyCallState.isInCall = false;
                pageManager.tallyCallState.currentChannelName = '';
                pageManager.tallyCallState.currentUid = null;
                
                updateTallyCallPageDisplay();
                
                if (tallyCallToggleBtn) {
                    tallyCallToggleBtn.disabled = false;
                }
                
                updateTallyCallStatus('disconnected', 'å·²é€€å‡ºé€šè¯');
                
            } catch (leaveErr) {
                console.error("TALLY+é€šè¯ï¼šé€€å‡ºé¢‘é“å¤±è´¥ï¼š", leaveErr);
                updateTallyCallStatus('error', `é€€å‡ºé€šè¯å¤±è´¥ï¼š${leaveErr.message}`);
                
                const tallyCallToggleBtn = document.getElementById('tallyCallToggle');
                if (tallyCallToggleBtn) {
                    tallyCallToggleBtn.disabled = false;
                }
            }
        }
        
        // é¡µé¢å…³é—­å‰æ¸…ç†
        window.addEventListener('beforeunload', function(e) {
            let inCall = false;
            let message = '';
            
            if (pageManager.callPageState.isInCall) {
                inCall = true;
                message = 'æ‚¨æ­£åœ¨é€šè¯ä¸­ï¼Œç¡®å®šè¦ç¦»å¼€å—ï¼Ÿ';
            }
            
            if (pageManager.tallyCallState.isInCall) {
                inCall = true;
                message = 'æ‚¨æ­£åœ¨TALLY+é€šè¯ä¸­ï¼Œç¡®å®šè¦ç¦»å¼€å—ï¼Ÿ';
            }
            
            if (inCall) {
                e.returnValue = message;
                return message;
            }
        });
        
        // é¡µé¢éšè—æ—¶æš‚åœéŸ³é¢‘
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                if (pageManager.callPageState.isInCall) {
                    console.log('é¡µé¢è¿›å…¥åå°ï¼Œé€šè¯ä¿æŒä¸­...');
                }
                if (pageManager.tallyCallState.isInCall) {
                    console.log('é¡µé¢è¿›å…¥åå°ï¼ŒTALLY+é€šè¯ä¿æŒä¸­...');
                }
            } else {
                if (pageManager.callPageState.isInCall) {
                    console.log('é¡µé¢å›åˆ°å‰å°');
                }
                if (pageManager.tallyCallState.isInCall) {
                    console.log('é¡µé¢å›åˆ°å‰å°');
                }
            }
        });
        
        // è®©å‡½æ•°åœ¨å…¨å±€å¯ç”¨
        window.toggleCall = toggleCall;
        window.toggleMicrophone = toggleMicrophone;
        window.toggleTallyCall = toggleTallyCall;
        window.toggleTallyMicrophone = toggleTallyMicrophone;
    </script>
</body>
</html>